<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Item Details - Lost & Found</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/main.css">
  <style>
    /* Responsive main content padding */
    .item-content {
      padding-top: 120px;
      padding-bottom: 100px;
    }

    @media (max-width: 768px) {
      .item-content {
        padding-top: 100px !important;
        padding-bottom: 80px !important;
      }
    }

    @media (max-width: 576px) {
      .item-content {
        padding-top: 90px !important;
        padding-bottom: 60px !important;
      }
      
      .navbar-logo {
        height: 50px !important;
      }
    }
    
    @media (max-width: 400px) {
      .navbar-logo {
        height: 40px !important;
      }
    }
  </style>
</head>

<body>
<!-- Navbar (same as search.html for consistency) -->
<nav class="navbar navbar-expand-lg navbar-dark shadow-sm fixed-top" style="background: linear-gradient(to right, #1E3A8A, #14B8A6);">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center" href="#" onclick="navigateTo('index.html')">
        <img src="assets/images/logo.png" alt="VIT Pune Logo" height="70" class="navbar-logo" style="object-fit: contain;">
        <img src="assets/images/TIClogo.png" alt="TIC VIT Pune Logo" height="70" class="navbar-logo" style="object-fit: contain; margin-left: 5px;">
      </a>

      <button class="navbar-toggler d-lg-none ms-auto" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto d-lg-none">
          <li class="nav-item">
            <a class="nav-link active" href="index.html">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="report.html">Report Lost</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="found.html">Report Found</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="search.html">Browse Items</a>
          </li>
        </ul>
        <div class="d-none d-lg-flex ms-auto">
          <button class="btn btn-link text-white me-4" onclick="navigateTo('index.html')">Home</button>
          <button class="btn btn-link text-white me-4" onclick="navigateTo('report.html')">Report Lost</button>
          <button class="btn btn-link text-white me-4" onclick="navigateTo('found.html')">Report Found</button>
          <button class="btn btn-accent fw-bold" style="text-decoration: underline;" onclick="navigateTo('search.html')">Browse Items</button>
        </div>
      </div>
    </div>
  </nav>

<!-- Main Content -->
<div class="container item-content">
  <button class="btn btn-outline-secondary mb-4" onclick="history.back()">
    ‚Üê Back to Results
  </button>

  <div class="row g-4">
    <!-- Image Section -->
    <div class="col-12 col-lg-6">
      <div class="position-relative rounded-4 overflow-hidden shadow-lg">
        <img id="item-image" class="w-100" style="height:420px; object-fit:cover;">
        <span id="match-badge" class="badge bg-warning position-absolute top-0 end-0 m-3 fs-6">
          88% Match
        </span>
      </div>

      <!-- AI Detection Card -->
      <div class="ai-card mt-4 p-4 rounded-4">
        <div class="d-flex align-items-center mb-2">
          <span class="ai-icon me-2">‚úì</span>
          <h6 class="mb-0 fw-semibold">AI Detection Results</h6>
        </div>
        <p class="text-muted small mb-0">
          This item was analyzed using YOLO object detection and color clustering.
        </p>
      </div>
    </div>

    <!-- Details Section -->
    <div class="col-12 col-lg-6">
      <span id="item-category" class="badge bg-light text-primary mb-2"></span>
      <h2 id="item-name" class="fw-bold mb-2"></h2>
      <p class="text-muted mb-4">Found item waiting to be claimed</p>

      <ul class="list-unstyled mb-4">
        <li class="mb-2">üìç <strong>Location:</strong> <span id="item-location"></span></li>
        <li class="mb-2">üìÖ <strong>Date:</strong> <span id="item-date"></span></li>
        <li class="mb-2">üé® <strong>Primary Color:</strong>
          <span class="color-dot" id="item-color-dot"></span>
          <span id="item-color"></span>
        </li>
      </ul>

      <h5 class="fw-semibold">Item Description</h5>
      <p id="item-description" class="text-muted mb-4"></p>

      <div id="contact-section">
        <button class="btn btn-accent w-100 mb-3" onclick="openVerificationModal()">
          <svg class="me-2" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
            <circle cx="8.5" cy="7" r="4"/>
            <line x1="20" y1="8" x2="20" y2="14"/>
            <line x1="23" y1="11" x2="17" y2="11"/>
          </svg>
          Request Contact Details
        </button>
        <p class="text-muted small text-center mb-0">
          <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="10"/>
            <path d="M12 16v-4"/>
            <path d="M12 8h.01"/>
          </svg>
          Verification required to protect both parties
        </p>
      </div>

      <div id="contact-details" class="alert alert-success" style="display:none;">
        <h5 class="fw-semibold mb-3">Contact Information</h5>
        <p class="mb-2"><strong>Name:</strong> <span id="finder-name"></span></p>
        <p class="mb-2"><strong>Email:</strong> <span id="finder-email"></span></p>
        <p class="mb-2"><strong>Phone:</strong> <span id="finder-phone"></span></p>
        <p class="text-muted small mb-0">Please contact the finder to arrange pickup.</p>
      </div>
    </div>
  </div>
</div>

<!-- Verification Modal -->
<div class="modal fade" id="verificationModal" tabindex="-1" aria-labelledby="verificationModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header" style="background: linear-gradient(to bottom right, var(--primary), var(--secondary));">
        <h5 class="modal-title text-white" id="verificationModalLabel">
          <svg class="me-2" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
            <path d="M9 12l2 2 4-4"/>
          </svg>
          Identity Verification Required
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="alert alert-info mb-4">
          <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="10"/>
            <path d="M12 16v-4"/>
            <path d="M12 8h.01"/>
          </svg>
          <strong>Security Check:</strong> Please verify your identity to receive contact details. This helps prevent fraud and protects both parties.
        </div>

        <form id="verificationForm">
          <!-- ID Card Upload -->
          <div class="mb-4">
            <label class="form-label fw-semibold">
              <svg class="me-2" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                <rect x="2" y="7" width="20" height="14" rx="2" ry="2"/>
                <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/>
              </svg>
              Upload College ID Card <span class="text-danger">*</span>
            </label>
            <input type="file" class="form-control" id="idCard" accept="image/*" required>
            <small class="text-muted">Clear photo of your student ID card</small>
          </div>

          <!-- Name -->
          <div class="mb-3">
            <label for="fullName" class="form-label fw-semibold">Full Name <span class="text-danger">*</span></label>
            <input type="text" class="form-control" id="fullName" required placeholder="Enter your full name">
          </div>

          <div class="row g-3 mb-3">
            <!-- Department -->
            <div class="col-md-6">
              <label for="department" class="form-label fw-semibold">Department <span class="text-danger">*</span></label>
              <select class="form-select" id="department" required>
                <option value="">Select Department</option>
                <option value="Computer Engineering">Computer Engineering</option>
                <option value="Information Technology">Information Technology</option>
                <option value="Electronics & Telecommunication">Electronics & Telecommunication</option>
                <option value="Mechanical Engineering">Mechanical Engineering</option>
                <option value="Civil Engineering">Civil Engineering</option>
                <option value="Electronics Engineering">Electronics Engineering</option>
                <option value="Instrumentation Engineering">Instrumentation Engineering</option>
                <option value="Production Engineering">Production Engineering</option>
                <option value="Artificial Intelligence & Data Science">AI & Data Science</option>
              </select>
            </div>

            <!-- Division -->
            <div class="col-md-6">
              <label for="division" class="form-label fw-semibold">Division <span class="text-danger">*</span></label>
              <select class="form-select" id="division" required>
                <option value="">Select Division</option>
                <option value="A">A</option>
                <option value="B">B</option>
                <option value="C">C</option>
                <option value="D">D</option>
              </select>
            </div>
          </div>

          <div class="row g-3 mb-3">
            <!-- Year of Study -->
            <div class="col-md-6">
              <label for="year" class="form-label fw-semibold">Year of Study <span class="text-danger">*</span></label>
              <select class="form-select" id="year" required>
                <option value="">Select Year</option>
                <option value="FE">First Year (FE)</option>
                <option value="SE">Second Year (SE)</option>
                <option value="TE">Third Year (TE)</option>
                <option value="BE">Final Year (BE)</option>
              </select>
            </div>

            <!-- PRN Number -->
            <div class="col-md-6">
              <label for="prn" class="form-label fw-semibold">PRN Number <span class="text-danger">*</span></label>
              <input type="text" class="form-control" id="prn" required placeholder="Enter PRN number">
            </div>
          </div>

          <!-- College Email -->
          <div class="mb-3">
            <label for="collegeEmail" class="form-label fw-semibold">College Email ID <span class="text-danger">*</span></label>
            <input type="email" class="form-control" id="collegeEmail" required placeholder="yourname@vit.edu" pattern=".*@vit\.edu$">
            <small class="text-muted">Must be a valid VIT email address (@vit.edu)</small>
          </div>

          <!-- Item Details to be Received -->
          <div class="mb-4">
            <label for="itemDetails" class="form-label fw-semibold">Item Details You're Claiming <span class="text-danger">*</span></label>
            <textarea class="form-control" id="itemDetails" rows="3" required placeholder="Describe the item you lost in detail (color, brand, unique features, contents, etc.)"></textarea>
            <small class="text-muted">Provide specific details to verify ownership</small>
          </div>

          <!-- Consent -->
          <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" id="consentCheck" required>
            <label class="form-check-label" for="consentCheck">
              I confirm that the information provided is accurate and I am the rightful owner of this item.
            </label>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="submitVerification()">
          <svg class="me-2" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
          Submit Verification
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="assets/js/api_client.js"></script>
<script src="assets/js/item.js"></script>
<script>
  function openVerificationModal() {
    const modal = new bootstrap.Modal(document.getElementById('verificationModal'));
    modal.show();
  }

  function submitVerification() {
    const form = document.getElementById('verificationForm');
    
    if (!form.checkValidity()) {
      form.reportValidity();
      return;
    }

    // Get item name from URL
    const urlParams = new URLSearchParams(window.location.search);
    const itemName = urlParams.get('item');

    // Collect verification data
    const verificationData = {
      itemName: itemName,
      timestamp: new Date().toISOString(),
      fullName: document.getElementById('fullName').value,
      department: document.getElementById('department').value,
      division: document.getElementById('division').value,
      year: document.getElementById('year').value,
      prn: document.getElementById('prn').value,
      collegeEmail: document.getElementById('collegeEmail').value,
      itemDetails: document.getElementById('itemDetails').value,
      idCardUploaded: document.getElementById('idCard').files.length > 0
    };

    // Save verification request to localStorage
    const verificationRequests = JSON.parse(localStorage.getItem('verificationRequests') || '[]');
    verificationRequests.push(verificationData);
    localStorage.setItem('verificationRequests', JSON.stringify(verificationRequests));

    // Hide modal
    const modal = bootstrap.Modal.getInstance(document.getElementById('verificationModal'));
    modal.hide();

    // Show success message and contact details
    document.getElementById('contact-section').style.display = 'none';
    const contactDetails = document.getElementById('contact-details');
    contactDetails.style.display = 'block';
    
    // Mock contact details (in real app, this would come from the finder's data)
    document.getElementById('finder-name').textContent = 'Contact Admin';
    document.getElementById('finder-email').textContent = 'lostandfound@vit.edu';
    document.getElementById('finder-phone').textContent = '+91 XXXXX XXXXX';

    // Show success alert
    const successAlert = document.createElement('div');
    successAlert.className = 'alert alert-success alert-dismissible fade show mt-3';
    successAlert.innerHTML = `
      <strong>Verification Submitted!</strong> Your request has been recorded. The item finder will be notified and may contact you to verify ownership.
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    contactDetails.insertAdjacentElement('afterend', successAlert);

    // Reset form
    form.reset();
  }
</script>
</body>
</html>
